# COS上传功能测试指南

## 🧪 测试步骤

### 1. 准备工作

- ✅ 后端服务器已启动 (http://localhost:8000)
- ✅ 前端服务器已启动 (http://localhost:5173)
- ✅ 腾讯云COS JS SDK已安装
- ✅ COS上传工具类已创建

### 2. 测试流程

1. **访问上传页面**
   - 打开浏览器访问: http://localhost:5173
   - 导航到上传页面

2. **用户认证**
   - 注册新用户或登录现有用户
   - 确保获得有效的认证token

3. **文件上传测试**
   - 选择一个测试文件（图片、视频或音频）
   - 点击"验证文件"按钮测试文件验证
   - 点击"开始上传"按钮测试完整上传流程

### 3. 预期结果

#### 成功场景

- ✅ 文件验证通过
- ✅ 成功获取STS临时凭证
- ✅ COS上传器初始化成功
- ✅ 文件上传进度正常显示
- ✅ 上传完成后显示访问URL

#### 可能的错误场景

- ❌ "获取STS临时凭证失败" - 检查后端环境变量配置
- ❌ "存储桶不存在" - 检查COS_BUCKET环境变量
- ❌ "访问被拒绝" - 检查腾讯云API密钥权限
- ❌ "无效的访问密钥" - 检查COS_SECRET_ID和COS_SECRET_KEY

## 🔧 故障排除

### 检查后端配置

```bash
# 检查环境变量
echo $COS_SECRET_ID
echo $COS_SECRET_KEY
echo $COS_REGION
echo $COS_BUCKET
```

### 检查后端日志

```bash
# 查看服务器日志
tail -f /Users/tennis/Documents/code/rust/media-hub/backend/media-server/logs/media-server.log.*
```

### 检查前端控制台

- 打开浏览器开发者工具
- 查看Console标签页的错误信息
- 查看Network标签页的API请求状态

## 📋 测试清单

- [ ] 后端服务器正常启动
- [ ] 前端服务器正常启动
- [ ] 用户注册/登录功能正常
- [ ] COS配置API返回正确信息
- [ ] STS凭证API返回有效凭证
- [ ] 文件验证功能正常
- [ ] 文件上传进度显示正常
- [ ] 上传完成后返回正确的URL
- [ ] 错误处理和用户提示正常

## 🎯 集成完成标志

当以下所有功能都正常工作时，COS集成即为完成：

1. ✅ 前端成功集成腾讯云COS JS SDK
2. ✅ 从后端获取STS临时凭证
3. ✅ 使用临时凭证直接上传文件到COS
4. ✅ 显示上传进度和结果
5. ✅ 错误处理和用户友好提示
6. ✅ 资源清理和内存管理
